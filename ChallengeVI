/*
Create a method that creates N number of accounts, within it call a second method that creates n contacts. 
Relate the newly created cointacts to the newly created accounts. 

As a part of this fill out the following fields for each account:
Name, annual revenue, phone, and site.

Fill out the following fields: 
Last name, first name, phone, and email.

for Phone field
String.valueOf(11).leftPad(10, '5');

Once these are created ensure they are inserted into the data base.

Create a third method that gets all child contacts from the account using a relationship query, 
and then changes the contact phone number to the account phone number.

Persist these changes.

Query for contacts and retrive each contacts first and last name, and then the related account name, 
phone, and site. Using system.debug display each of these in a debug log.
Name = 'NewAccount#'+i, AnuualRevenue=''+i, Phone=i, Site='site#'+i
*/

public class ChallengeVI {
    
    public void createAccounts(integer n){  
   	 	List<Account> myAccList = new List<Account>();
        for(integer i=0; i<n; i++){
    	  Account newAcc = new Account();
            newAcc.Name = 'NewAccount#'+i;
            newAcc.AnnualRevenue = i;
            newAcc.Phone = '123456789';
            newAcc.Site = 'www.'+i+'.com';
            myAccList.add(newAcc);
    	}
        insert myAccList;
        CreateContacts(myAccList);
    }
    
    public void CreateContacts(List<Account> AccList){
        List<Contact> nyContList = new List<Contact>();
        for(Account a : AccList){
            Contact c = new Contact();
            c.LastName = a.name+'Spiderman';
            c.FirstName = 'Bob';
            c.Phone = '987654321';
            c.Email = c.FirstName + '@'+a.name+'.com';

        }
        insert nyContList;

    }
    
    public void UpdateChildContacts(){
        List<Account> AccList = [SELECT phone, (SELECT Id, phone FROM Contacts) FROM Account];
        List<Contact> ConList = new List<Contact>();
        for(Account a: AccList){
            if(a.Contacts != null){
            	List<Contact> curCont = a.Contacts;
            	for(Contact c: curCont){
               	 c.Phone = a.Phone;
               	 ConList.add(c);
            }
          }
        }
        update ConList;
    }
    
    public void SystemLog(){
        for(contact c : [SELECT FirstName, LastName, Account.Name, Account.Phone, Account.Site FROM Contact]){
            system.debug(c.FirstName +' '+c.LastName+', FROM: '+c.Account.Name +'. Reachable at: '+c.Account.Phone + ' and '+c.Account.Site);
        }
    }
    
    

}
